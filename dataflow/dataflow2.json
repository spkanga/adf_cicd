{
	"name": "dataflow2",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "AzureSqlTable3",
						"type": "DatasetReference"
					},
					"name": "dimEmployee"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlTable3",
						"type": "DatasetReference"
					},
					"name": "StgEmployee"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSqlTable4",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "GenerateHashValue"
				},
				{
					"name": "IsHashFound"
				},
				{
					"name": "FindBusinessKey"
				},
				{
					"name": "AddInsertedUpdated"
				},
				{
					"name": "Upsertif"
				}
			],
			"script": "\n\nsource(output(\n\t\tEmployeeKey as integer,\n\t\tBusinessEntityID as string,\n\t\tNationalIDNumber as string,\n\t\tLoginID as string,\n\t\tOrganizationNode as string,\n\t\tOrganizationLevel as string,\n\t\tJobTitle as string,\n\t\tBirthDate as string,\n\t\tMaritalStatus as string,\n\t\tGender as string,\n\t\tHireDate as string,\n\t\tSalariedFlag as string,\n\t\tVacationHours as string,\n\t\tSickLeaveHours as string,\n\t\tCurrentFlag as string,\n\t\trowguid as string,\n\t\tModifiedDate as string,\n\t\t{_inserted} as timestamp,\n\t\t{_lastUpdated} as timestamp,\n\t\t{_HashValue} as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tbatchSize: 1,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM [dbo].[dimEmployee]',\n\tformat: 'query') ~> dimEmployee\nsource(output(\n\t\tBusinessEntityID as string,\n\t\tNationalIDNumber as string,\n\t\tLoginID as string,\n\t\tOrganizationNode as string,\n\t\tOrganizationLevel as string,\n\t\tJobTitle as string,\n\t\tBirthDate as string,\n\t\tMaritalStatus as string,\n\t\tGender as string,\n\t\tHireDate as string,\n\t\tSalariedFlag as string,\n\t\tVacationHours as string,\n\t\tSickLeaveHours as string,\n\t\tCurrentFlag as string,\n\t\trowguid as string,\n\t\tModifiedDate as string,\n\t\t{_inserted} as timestamp,\n\t\t{_lastUpdated} as timestamp,\n\t\tStgHash as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tbatchSize: 100,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM [dbo].[employee]',\n\tformat: 'query') ~> StgEmployee\nStgEmployee derive(StgHash = sha1(BusinessEntityID + NationalIDNumber + OrganizationNode)) ~> GenerateHashValue\nGenerateHashValue, dimEmployee exists(GenerateHashValue@StgHash == {_HashValue},\n\tnegate:true,\n\tbroadcast: 'none')~> IsHashFound\nIsHashFound, dimEmployee lookup(StgEmployee@BusinessEntityID == dimEmployee@BusinessEntityID,\n\tbroadcast: 'none')~> FindBusinessKey\nFindBusinessKey derive({_inserted} = iif(isNull(StgEmployee@{_inserted}),currentTimestamp(),StgEmployee@{_inserted}),\n\t\t{_lastUpdated} = iif(isNull(StgEmployee@{_lastUpdated}),currentTimestamp(),StgEmployee@{_lastUpdated}),\n\tpartitionBy('roundRobin', 2)) ~> AddInsertedUpdated\nAddInsertedUpdated alterRow(upsertIf(true())) ~> Upsertif\nUpsertif sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['BusinessEntityID'],\n\tformat: 'table',\n\tmapColumn(\n\t\tBusinessEntityID = StgEmployee@BusinessEntityID,\n\t\tNationalIDNumber = StgEmployee@NationalIDNumber,\n\t\tLoginID = StgEmployee@LoginID,\n\t\tOrganizationNode = StgEmployee@OrganizationNode,\n\t\tOrganizationLevel = StgEmployee@OrganizationLevel,\n\t\tJobTitle = StgEmployee@JobTitle,\n\t\tBirthDate = StgEmployee@BirthDate,\n\t\tMaritalStatus = StgEmployee@MaritalStatus,\n\t\tGender = StgEmployee@Gender,\n\t\tHireDate = StgEmployee@HireDate,\n\t\tSalariedFlag = StgEmployee@SalariedFlag,\n\t\tVacationHours = StgEmployee@VacationHours,\n\t\tSickLeaveHours = StgEmployee@SickLeaveHours,\n\t\tCurrentFlag = StgEmployee@CurrentFlag,\n\t\trowguid = StgEmployee@rowguid,\n\t\tModifiedDate = StgEmployee@ModifiedDate,\n\t\t{_inserted},\n\t\t{_lastUpdated},\n\t\t{_HashValue} = StgHash,\n\t\tEmployeeKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
		}
	}
}